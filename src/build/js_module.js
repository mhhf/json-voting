'use strict';

// For geth
if (typeof dapple === 'undefined') {
  var dapple = {};
}

if (typeof web3 === 'undefined' && typeof Web3 === 'undefined') {
  var Web3 = require('web3');
}

dapple['src'] = (function builder () {
  var environments = {};

  function ContractWrapper (headers, _web3) {
    if (!_web3) {
      throw new Error('Must supply a Web3 connection!');
    }

    this.headers = headers;
    this._class = _web3.eth.contract(headers.interface);
  }

  ContractWrapper.prototype.deploy = function () {
    var args = new Array(arguments);
    args[args.length - 1].data = this.headers.bytecode;
    return this._class.new.apply(this._class, args);
  };

  // Wrap pass-through functions by name.
  var passthroughs = ['at', 'new'];
  for (var i = 0; i < passthroughs.length; i += 1) {
    ContractWrapper.prototype[passthroughs[i]] = (function (passthrough) {
      return function () {
        return this._class[passthrough].apply(this._class, arguments);
      };
    })(passthroughs[i]);
  }

  function constructor (_web3, env) {
    if (!env) {
      env = {};
    }
    while (typeof env !== 'object') {
      env = environments[env];
    }

    if (typeof _web3 === 'undefined') {
      if (!env.rpcURL) {
        throw new Error('Need either a Web3 instance or an RPC URL!');
      }
      _web3 = new Web3(new Web3.providers.HttpProvider(env.rpcURL));
    }

    this.headers = {
      'migration': {
        'interface': [],
        'solidity_interface': 'contract migration{}',
        'bytecode': '6060604052600a8060106000396000f360606040526008565b00'
      },
      'only_consens': {
        'interface': [
          {
            'inputs': [],
            'type': 'constructor'
          }
        ],
        'solidity_interface': 'contract only_consens{function only_consens();}',
        'bytecode': '60606040525b5b600a8060126000396000f360606040526008565b00'
      },
      'org': {
        'interface': [
          {
            'constant': false,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              }
            ],
            'name': 'evolve',
            'outputs': [
              {
                'name': '',
                'type': 'bool'
              }
            ],
            'type': 'function'
          },
          {
            'constant': false,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              },
              {
                'name': '_candidate',
                'type': 'string'
              }
            ],
            'name': 'propose',
            'outputs': [],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [],
            'name': 'numOrgs',
            'outputs': [
              {
                'name': 'number',
                'type': 'uint256'
              }
            ],
            'type': 'function'
          },
          {
            'constant': false,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              },
              {
                'name': '_candidate',
                'type': 'string'
              },
              {
                'name': '_vote',
                'type': 'uint256'
              }
            ],
            'name': 'vote',
            'outputs': [],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [],
            'name': 'getAll',
            'outputs': [
              {
                'name': 'names',
                'type': 'bytes32[]'
              }
            ],
            'type': 'function'
          },
          {
            'constant': false,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              },
              {
                'name': '_evolutionSchema',
                'type': 'bytes32'
              },
              {
                'name': 'vote',
                'type': 'uint256'
              }
            ],
            'name': 'voteEvolution',
            'outputs': [],
            'type': 'function'
          },
          {
            'constant': false,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              },
              {
                'name': '_addr',
                'type': 'address'
              },
              {
                'name': '_value',
                'type': 'uint256'
              }
            ],
            'name': 'send',
            'outputs': [],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [
              {
                'name': '',
                'type': 'uint256'
              }
            ],
            'name': 'evolutionSchemasArray',
            'outputs': [
              {
                'name': '',
                'type': 'bytes32'
              }
            ],
            'type': 'function'
          },
          {
            'constant': false,
            'inputs': [
              {
                'name': 'name',
                'type': 'bytes32'
              },
              {
                'name': '_language',
                'type': 'bytes32'
              }
            ],
            'name': 'newOrg',
            'outputs': [
              {
                'name': '',
                'type': 'bool'
              }
            ],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              },
              {
                'name': '_addr',
                'type': 'address'
              }
            ],
            'name': 'getShares',
            'outputs': [
              {
                'name': 'shares',
                'type': 'uint256'
              }
            ],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              }
            ],
            'name': 'getConsens',
            'outputs': [
              {
                'name': '_candidate',
                'type': 'string'
              }
            ],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [
              {
                'name': '',
                'type': 'uint256'
              }
            ],
            'name': 'orgasArray',
            'outputs': [
              {
                'name': '',
                'type': 'bytes32'
              }
            ],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              }
            ],
            'name': 'getCandidatesLength',
            'outputs': [
              {
                'name': 'numCandidates',
                'type': 'uint256'
              }
            ],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              }
            ],
            'name': 'getConsensIndex',
            'outputs': [
              {
                'name': '_index',
                'type': 'uint256'
              }
            ],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              }
            ],
            'name': 'info',
            'outputs': [
              {
                'name': 'numOwners',
                'type': 'uint256'
              },
              {
                'name': 'size',
                'type': 'uint256'
              },
              {
                'name': 'numCandidates',
                'type': 'uint256'
              },
              {
                'name': 'language',
                'type': 'bytes32'
              },
              {
                'name': 'numEvolutions',
                'type': 'uint256'
              }
            ],
            'type': 'function'
          },
          {
            'constant': true,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              },
              {
                'name': '_at',
                'type': 'uint256'
              }
            ],
            'name': 'getCandidateAt',
            'outputs': [
              {
                'name': '_candidate',
                'type': 'string'
              }
            ],
            'type': 'function'
          },
          {
            'constant': false,
            'inputs': [
              {
                'name': 'name',
                'type': 'bytes32'
              },
              {
                'name': '_L_1',
                'type': 'bytes32'
              },
              {
                'name': '_L_2',
                'type': 'bytes32'
              },
              {
                'name': '_migration',
                'type': 'string'
              }
            ],
            'name': 'newEvolutionSchema',
            'outputs': [
              {
                'name': '',
                'type': 'bool'
              }
            ],
            'type': 'function'
          },
          {
            'constant': false,
            'inputs': [
              {
                'name': '_orga',
                'type': 'bytes32'
              },
              {
                'name': '_evolutionSchema',
                'type': 'bytes32'
              }
            ],
            'name': 'proposeEvolution',
            'outputs': [
              {
                'name': '',
                'type': 'bool'
              }
            ],
            'type': 'function'
          },
          {
            'inputs': [],
            'type': 'constructor'
          }
        ],
        'solidity_interface': 'contract org{function org();function evolve(bytes32 _orga)returns(bool );function propose(bytes32 _orga,string _candidate);function numOrgs()constant returns(uint256 number);function vote(bytes32 _orga,string _candidate,uint256 _vote);function getAll()constant returns(bytes32[] names);function voteEvolution(bytes32 _orga,bytes32 _evolutionSchema,uint256 vote);function send(bytes32 _orga,address _addr,uint256 _value);function evolutionSchemasArray(uint256 )constant returns(bytes32 );function newOrg(bytes32 name,bytes32 _language)returns(bool );function getShares(bytes32 _orga,address _addr)constant returns(uint256 shares);function getConsens(bytes32 _orga)constant returns(string _candidate);function orgasArray(uint256 )constant returns(bytes32 );function getCandidatesLength(bytes32 _orga)constant returns(uint256 numCandidates);function getConsensIndex(bytes32 _orga)constant returns(uint256 _index);function info(bytes32 _orga)constant returns(uint256 numOwners,uint256 size,uint256 numCandidates,bytes32 language,uint256 numEvolutions);function getCandidateAt(bytes32 _orga,uint256 _at)constant returns(string _candidate);function newEvolutionSchema(bytes32 name,bytes32 _L_1,bytes32 _L_2,string _migration)returns(bool );function proposeEvolution(bytes32 _orga,bytes32 _evolutionSchema)returns(bool );}',
        'bytecode': '60606040525b5b611ccf806100146000396000f3606060405236156100f8576000357c01000000000000000000000000000000000000000000000000000000009004806301baa968146100fa578063042e9a431461012657806315a55fc5146101855780634f5b75c5146101a857806353ed5143146102105780635562abd2146102675780635720e67e1461029157806358a2bcc7146102bb5780635e1d754b146102e75780635ebb58fb1461031c578063873ab5551461035157806397e76451146103d55780639919ebe914610401578063af166b0c1461042d578063b64a097e14610459578063df867254146104a1578063e394527a1461052e578063ee287432146105b3576100f8565b005b61011060048080359060200190919050506116c6565b6040518082815260200191505060405180910390f35b6101836004808035906020019091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091905050610b50565b005b6101926004805050610632565b6040518082815260200191505060405180910390f35b61020e6004808035906020019091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019091905050610d2b565b005b61021d6004805050610647565b60405180806020018281038252838181518152602001915080519060200190602002808383829060006004602084601f0104600f02600301f1509050019250505060405180910390f35b61028f600480803590602001909190803590602001909190803590602001909190505061165e565b005b6102b960048080359060200190919080359060200190919080359060200190919050506113f2565b005b6102d1600480803590602001909190505061060d565b6040518082815260200191505060405180910390f35b61030660048080359060200190919080359060200190919050506106bc565b6040518082815260200191505060405180910390f35b61033b60048080359060200190919080359060200190919050506114d0565b6040518082815260200191505060405180910390f35b6103676004808035906020019091905050610dbb565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156103c75780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6103eb60048080359060200190919050506105e8565b6040518082815260200191505060405180910390f35b61041760048080359060200190919050506112cf565b6040518082815260200191505060405180910390f35b61044360048080359060200190919050506110b6565b6040518082815260200191505060405180910390f35b61046f6004808035906020019091905050610ad9565b604051808681526020018581526020018481526020018381526020018281526020019550505050505060405180910390f35b6104c06004808035906020019091908035906020019091905050611300565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156105205780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b61059d6004808035906020019091908035906020019091908035906020019091908035906020019082018035906020019191908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509090919050506108f6565b6040518082815260200191505060405180910390f35b6105d26004808035906020019091908035906020019091905050611529565b6040518082815260200191505060405180910390f35b600160005081815481101561000257906000526020600020900160005b915090505481565b600260005081815481101561000257906000526020600020900160005b915090505481565b60006001600050805490509050610644565b90565b602060405190810160405280600081526020015060016000508054806020026020016040519081016040528092919081815260200182805480156106ad57602002820191906000526020600020905b816000505481526020019060010190808311610696575b505050505090506106b9565b90565b60006000600360005060008581526020019081526020016000206000509050600081600201600050541415156106f557600091506108ef565b60016000508054809190600101909081548183558181151161074957818360005260206000209182019101610748919061072a565b80821115610744576000818150600090555060010161072a565b5090565b5b50505050836001600050600160016000508054905003815481101561000257906000526020600020900160005b508190555060036000506000858152602001908152602001600020600050600001600050805480919060010190908154818355818115116107e9578183600052602060002091820191016107e891906107ca565b808211156107e457600081815060009055506001016107ca565b5090565b5b5050505033600360005060008681526020019081526020016000206000506000016000506000815481101561000257906000526020600020900160005b6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055506127106003600050600086815260200190815260200160002060005060010160005060003373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050819055506127106003600050600086815260200190815260200160002060005060020160005081905550826003600050600086815260200190815260200160002060005060040160005081905550600191506108ef565b5092915050565b60006000600060005060008781526020019081526020016000206000509050600060010281600001600050541415156109325760009150610ad0565b600260005080548091906001019090815481835581811511610986578183600052602060002091820191016109859190610967565b808211156109815760008181506000905550600101610967565b5090565b5b50505050856002600050600160026000508054905003815481101561000257906000526020600020900160005b508190555084600060005060008881526020019081526020016000206000506000016000508190555083600060005060008881526020019081526020016000206000506001016000508190555082600060005060008881526020019081526020016000206000506002016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610a6957805160ff1916838001178555610a9a565b82800160010185558215610a9a579182015b82811115610a99578251826000505591602001919060010190610a7b565b5b509050610ac59190610aa7565b80821115610ac15760008181506000905550600101610aa7565b5090565b505060019150610ad0565b50949350505050565b6000600060006000600060006003600050600088815260200190815260200160002060005090508060000160005080549050955085508060020160005054945084508060030160005080549050935083508060040160005054925082508060060160005080549050915081505b5091939590929450565b6003600050600083815260200190815260200160002060005060030160005080548091906001019090815481835581811511610c1d57818360005260206000209182019101610c1c9190610b9f565b80821115610c18576000818150805460018160011615610100020316600290046000825580601f10610bd15750610c0e565b601f016020900490600052602060002090810190610c0d9190610bef565b80821115610c095760008181506000905550600101610bef565b5090565b5b5050600101610b9f565b5090565b5b5050505080600360005060008481526020019081526020016000206000506003016000506001600360005060008681526020019081526020016000206000506003016000508054905003815481101561000257906000526020600020900160005b509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610cc857805160ff1916838001178555610cf9565b82800160010185558215610cf9579182015b82811115610cf8578251826000505591602001919060010190610cda565b5b509050610d249190610d06565b80821115610d205760008181506000905550600101610d06565b5090565b50505b5050565b806003600050600085815260200190815260200160002060005060050160005083604051808280519060200190808383829060006004602084601f0104600f02600301f150905001915050908152602001604051809103902060005060003373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050819055505b505050565b60206040519081016040528060008152602001506000600060006000600060006000955060009450600360005060008981526020019081526020016000206000509350600092505b8360030160005080549050831015610fd55760009150600090505b8360000160005080549050811015610fb4578360010160005060008560000160005083815481101561000257906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005054846005016000508560030160005085815481101561000257906000526020600020900160005b506040518082805460018160011615610100020316600290048015610f215780601f10610eff576101008083540402835291820191610f21565b820191906000526020600020905b815481529060010190602001808311610f0d575b5050915050908152602001604051809103902060005060008660000160005084815481101561000257906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005054028201915081505b8080600101915050610e1e565b85821115610fc757819550855082945084505b5b8280600101935050610e03565b6003600050600089815260200190815260200160002060005060030160005085815481101561000257906000526020600020900160005b508054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156110a15780601f10611076576101008083540402835291602001916110a1565b820191906000526020600020905b81548152906001019060200180831161108457829003601f168201915b5050505050965086505b505050505050919050565b60006000600060006000600060006000955060009450600360005060008981526020019081526020016000206000509350600092505b83600301600050805490508310156112be5760009150600090505b836000016000508054905081101561129d578360010160005060008560000160005083815481101561000257906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005054846005016000508560030160005085815481101561000257906000526020600020900160005b50604051808280546001816001161561010002031660029004801561120a5780601f106111e857610100808354040283529182019161120a565b820191906000526020600020905b8154815290600101906020018083116111f6575b5050915050908152602001604051809103902060005060008660000160005084815481101561000257906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005054028201915081505b8080600101915050611107565b858211156112b057819550855082945084505b5b82806001019350506110ec565b84965086505b505050505050919050565b6000600360005060008381526020019081526020016000206000506003016000508054905090506112fb565b919050565b60206040519081016040528060008152602001506003600050600084815260200190815260200160002060005060030160005082815481101561000257906000526020600020900160005b508054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156113e05780601f106113b5576101008083540402835291602001916113e0565b820191906000526020600020905b8154815290600101906020018083116113c357829003601f168201915b505050505090506113ec565b92915050565b6000600360005060008581526020019081526020016000206000509050818160010160005060003373ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005054101561144d57610002565b818160010160005060008573ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082828250540192505081905550818160010160005060003373ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828282505403925050819055505b50505050565b60006003600050600084815260200190815260200160002060005060010160005060008373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050549050611523565b92915050565b60006003600050600084815260200190815260200160002060005060040160005054600060005060008481526020019081526020016000206000506000016000505414151561157b5760009050611658565b60036000506000848152602001908152602001600020600050600601600050805480919060010190908154818355818115116115e9578183600052602060002091820191016115e891906115ca565b808211156115e457600081815060009055506001016115ca565b5090565b5b5050505081600360005060008581526020019081526020016000206000506006016000506001600360005060008781526020019081526020016000206000506006016000508054905003815481101561000257906000526020600020900160005b508190555060019050611658565b92915050565b8060036000506000858152602001908152602001600020600050600701600050600084815260200190815260200160002060005060003373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050819055505b505050565b60006000600060006000600060006000600060006000600360005060008d81526020019081526020016000206000509950600098506000975060019650600095505b89600601600050805490508660ff1610156118915760009450600093505b89600001600050805490508460ff161015611862578960010160005060008b60000160005086815481101561000257906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050548a60070160005060008c60060160005089815481101561000257906000526020600020900160005b5054815260200190815260200160002060005060008c60000160005087815481101561000257906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005054028501945084505b8380600101945050611726565b868511801561187057508885115b156118835784985088508560ff16975087505b5b8580600101965050611708565b60008914156118a35760009a50611cc0565b600060005060008b6006016000508a815481101561000257906000526020600020900160005b50548152602001908152602001600020600050925082600101600050548a600401600050819055506118fa8c6110b6565b91508960030160005082815481101561000257906000526020600020900160005b50905085505b89600301600050805490508660ff161015611a7e57818660ff16141515611a70576000935083505b89600001600050805490508460ff161015611a6f57896005016000508a60030160005087815481101561000257906000526020600020900160005b5060405180828054600181600116156101000203166002900480156119e05780601f106119be5761010080835404028352918201916119e0565b820191906000526020600020905b8154815290600101906020018083116119cc575b5050915050908152602001604051809103902060005060008b60000160005086815481101561000257906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050600090555b8380600101945050611949565b5b5b8580600101965050611921565b8960030160005080546000825590600052602060002090810190611b1f9190611aa2565b80821115611b1b576000818150805460018160011615610100020316600290046000825580601f10611ad45750611b11565b601f016020900490600052602060002090810190611b109190611af2565b80821115611b0c5760008181506000905550600101611af2565b5090565b5b5050600101611aa2565b5090565b5b508960030160005080548091906001019090815481835581811511611bd657818360005260206000209182019101611bd59190611b58565b80821115611bd1576000818150805460018160011615610100020316600290046000825580601f10611b8a5750611bc7565b601f016020900490600052602060002090810190611bc69190611ba8565b80821115611bc25760008181506000905550600101611ba8565b5090565b5b5050600101611b58565b5090565b5b50505050808a60030160005060018c6003016000508054905003815481101561000257906000526020600020900160005b509080546001816001161561010002031660029004828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10611c555780548555611c92565b82800160010185558215611c9257600052602060002091601f016020900482015b82811115611c91578254825591600101919060010190611c76565b5b509050611cbd9190611c9f565b80821115611cb95760008181506000905550600101611c9f565b5090565b50505b5050505050505050505091905056'
      }
    };

    this.classes = {};
    for (var key in this.headers) {
      this.classes[key] = new ContractWrapper(this.headers[key], _web3);
    }

    this.objects = {};
    for (var i in env.objects) {
      var obj = env.objects[i];
      this.objects[i] = this.classes[obj['class']].at(obj.address);
    }
  }

  return {
    class: constructor,
    environments: environments
  };
})();

if (typeof module !== 'undefined' && module.exports) {
  module.exports = dapple['src'];
}
